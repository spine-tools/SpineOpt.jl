# How to impose renewable energy targets

This advanced concept illustrates how renewable targets can be realized in SpineOpt. 

## Imposing lower limits on renewable production
### Imposing a lower bound on the cumulated flow of a unit group by an absolute value
In the current landscape of energy systems modeling, especially in investment models, it is a common idea to implement a lower limit on the amount of electricity that is generated by renewable sources. SpineOpt allows the user to implement such restrictions by means of the [min\_total\_cumulated\_unit\_flow\_to\_node](@ref) parameter. Which will trigger the creation of the [constraint\_total\_cumulated\_unit\_flow](@ref constraint_total_cumulated_unit_flow).

To impose  a limit on overall renewable generation over the entire optimization horizon, the following objects, relationships, and parameters are relevant:

1. **[unit](@ref)**: In this case, a unit represents a process (e.g. electricity generation from wind), where one
  or multiple [unit\_flow](@ref)s are associated with renewable generation
2. **[node](@ref)**: Besides from nodes required to denote e.g. a fuel node or a supply node, at least one node should be introduced representing
    electricity demand.
    (*Note: To distinguish e.g. between regions there can also be more than one electricity node*)
3. **[unit\_\_to\_node](@ref)**: To associate electricity flows with a unit, the relationship between the unit and the electricity node needs to be imposed,
    to trigger the generation of a electricity-[unit\_flow](@ref) variable.
4. **[min\_total\_cumulated\_unit\_flow\_to\_node](@ref)**: This parameter triggers a lower bound on all cumulated flows from a unit (or a group of units), e.g. the group of all renewable generators, to a node (or node group).

Let's take a look at a simple example to see how this works. Suppose that we have a system with only one node, which represents the demand for electricity, and two units: a wind farm, and a conventional gas unit. To connect the wind farm to the electricity node, the [unit\_\_to\_node](@ref) relationship has to be defined.

One can then simply define the [min\_total\_cumulated\_unit\_flow\_to\_node](@ref) parameter for the 'wind_farm__to_electricity_node' relationship to impose a lower bound on the total generation origination from the wind farm.

Note that the value of this parameter is expected to be given as an absolute value, thus care has to be taken to make sure that the units match with the ones used for the [unit\_flow](@ref) variable.

The main source of flexibility in the use of this constraint lies in the possibility to define the parameter for relationships that link 'node_groups' and/or 'unit_groups'. For example, by grouping multiple units that are considered renewable sources (e.g. PV, and wind), targets can be implemented across multiple renewable sources. Similarly, by defining multiple electricity nodes, generation targets can be spatially disagreggated.

### Limiting the cumulated flow of a unit group by a share of the demand
For convenience, we want to be able to define the [min\_total\_cumulated\_unit\_flow\_to\_node](@ref), when used to set a renewable target, as a share of the demand. At the moment an absolute lower bound needs to be provided by the user, but we want to automate this preprocessing in SpineOpt. (*to be implemented*)

## Imposing an upper limit on carbon emissions
### Imposing an upper limit on carbon emissions over the entire optimization horizon
To impose a limit on overall carbon emissions over the entire optimization horizon,
the following objects, relationships and parameters are relevant:

1. **[unit](@ref)**: In this case, a unit represents a process (e.g. conversion of Gas to Electricity), where one
  or multiple [unit\_flow](@ref)s are associated with carbon emissions
2. **[node](@ref)**: Besides from nodes required to denote e.g. a fuel node or a supply node, at least one node should be introduced representing
    carbon emissions.
    (*Note: To distinguish e.g. between regions there can also be more than one carbon node*)
3. **[unit\_\_to\_node](@ref)**: To associate carbon flows with a unit, the relationship between the unit and the carbon node needs to be imposed,
    to trigger the generation of a carbon-[unit\_flow](@ref) variable.
4. **[unit\_\_node\_\_node](@ref)** and **[fix\_ratio\_out\_out](@ref) **: Ratio between e.g. output and output unit flows; e.g. how carbon intensive an electricity flow of a unit is. The parameter is defined on a [unit\_\_node\_\_node](@ref) relationship, for example (gasplant, Carbon, Electricity). (*Note: For a full list of possible ratios, see also [unit\_\_node\_\_node](@ref) and associated parameters*)
5. **[max\_total\_cumulated\_unit\_flow\_to\_node](@ref)** (and **[unit\_\_to\_node](@ref)**): This parameter triggers a limit on all flows from a unit (or a group of units), e.g. the group of all conventional generators, to a node (or node groups), e.g. considering the atmosphere as a fictive CO2 node, over the entire modelling horizon (e.g. a carbon budget). For example this could be defined on a relationship between a gasplant and a Carbon node, but can also be defined a unit group of all conventional generators and a carbon node. See also: [constraint\_total\_cumulated\_unit\_flow](@ref constraint_total_cumulated_unit_flow)


### Imposing an upper bound on the cumulated flows of a unit group for a specific period of time (advanced method)
If the desired functionality is not to cap emissions over the entire modelling horizon, but rather for specific periods of time (e.g., to impose decreasing carbon caps over time), an alternative method can be used, which will be described in the following.

To illustrate this functionality, we will assume that there is a ficticious cap of 100 for a period of time 2025-2030, and a cap of 50 for the period of time 2030-2035. In this simple example, we will assume that one carbon-emitting unit `carbon_unit` is present with two outgoing commodity flows, e.g. here electricity and carbon.

Three nodes are required to represent this system: an `electricity` node, a `carbon_cap_1` node (with `node_type=storage_node` and `node_state_cap=100`), and a `carbon_cap_2` node (with `node_type=storage_node` and `node_state_cap=50`).

Further we introduce the `unit__node__node` relationships between `carbon_unit__carbon_cap1__electricity` and `carbon_unit__carbon_cap2__electricity`. On these relationships, we will define the ratio between emissions and electricity production. In this fictious example, we will assume 0.5 units of emissions per unit of electricity.

The `fix_ratio_out_out` parameter will now be defined as a time varying parameter in the following way (*simplified representation of TimeSeries parameter*):

`fix_ratio_out_out(carbon_unit__carbon_cap1__electricity)` = [2025: 0.5; 2030: 0]
`fix_ratio_out_out(carbon_unit__carbon_cap2__electricity)` = [2025: 0; 2030: 0.5]

This way the first emission-cap node `carbon_cap1` can only be "filled" during the 2025-2030, while `carbon_cap2` can only be "filled" during the second period 2030-2035. 

Note that it would also be possible to have, e.g., one node with time-varying `node_state_cap`. However, in this case, "unused" carbon emissions in the first period of time would be availble for the second period of time.

## Imposing a carbon tax
To include carbon pricing in a model,
the following objects, relationships and parameters are relevant:

1. **[unit](@ref)**: In this case, a unit represents a process (e.g. conversion of Gas to Electricity), where one
  or multiple [unit\_flow](@ref)s are associated with carbon emissions
2. **[node](@ref)** and **[tax\_in\_unit\_flow](@ref)**: Besides from nodes required to denote e.g. a fuel node or a supply node, at least one node should be introduced representing carbon emissions. To associate a carbon-tax with all incoming [unit\_flow](@ref)s, the [tax\_in\_unit\_flow](@ref) parameter can be defined on this node
    (*Note: To distinguish e.g. between regions there can also be more than one carbon node*)
3. **[unit\_\_to\_node](@ref)**: To associate carbon flows with a unit, the relationship between the unit and the carbon node needs to be imposed,
    to trigger the generation of a carbon-[unit\_flow](@ref) variable.
4. **[unit\_\_node\_\_node](@ref)** and **[fix\_ratio\_out\_out](@ref) **: Ratio between e.g. output and output unit flows; e.g. how carbon intensive an electricity flow of a unit is. The parameter is defined on a [unit\_\_node\_\_node](@ref) relationship, for example (Gasplant, Carbon, Electricity). (*Note: For a full list of possible ratios, see also [unit\_\_node\_\_node](@ref) and associated parameters*)
