<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Stochastic structure · SpineOpt.jl</title><meta name="title" content="Stochastic structure · SpineOpt.jl"/><meta property="og:title" content="Stochastic structure · SpineOpt.jl"/><meta property="twitter:title" content="Stochastic structure · SpineOpt.jl"/><meta name="description" content="Documentation for SpineOpt.jl."/><meta property="og:description" content="Documentation for SpineOpt.jl."/><meta property="twitter:description" content="Documentation for SpineOpt.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/style.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="SpineOpt.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">SpineOpt.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../getting_started/installation/">Installation</a></li><li><a class="tocitem" href="../../getting_started/recommended_workflow/">Recommended workflow</a></li><li><a class="tocitem" href="../../getting_started/troubleshooting/">Troubleshooting</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../webinars/">Webinars and examples</a></li><li><a class="tocitem" href="../simple_system/">Simple system</a></li><li><a class="tocitem" href="../temporal_resolution/">Temporal resolution</a></li><li class="is-active"><a class="tocitem" href>Stochastic structure</a><ul class="internal"><li><a class="tocitem" href="#Setup-starting-from-simple-system-tutorial"><span>Setup starting from simple system tutorial</span></a></li><li><a class="tocitem" href="#Independent-scenarios"><span>Independent scenarios</span></a></li><li><a class="tocitem" href="#Stochastic-path"><span>Stochastic path</span></a></li></ul></li><li><a class="tocitem" href="../capacity_planning/">Capacity planning</a></li><li><a class="tocitem" href="../reserves/">Reserve requirements</a></li><li><a class="tocitem" href="../ramping/">Ramping constraints</a></li><li><a class="tocitem" href="../unit_commitment/">Unit Commitment</a></li></ul></li><li><span class="tocitem">How to</span><ul><li><a class="tocitem" href="../../how_to/change_the_solver/">Change the solver</a></li><li><a class="tocitem" href="../../how_to/compile_julia_system_image/">Compile julia system image</a></li><li><a class="tocitem" href="../../how_to/define_an_efficiency/">Define an efficiency</a></li><li><a class="tocitem" href="../../how_to/impose_renewable_energy_targets/">Impose renewable energy targets</a></li><li><a class="tocitem" href="../../how_to/manage_output/">Manage output</a></li><li><a class="tocitem" href="../../how_to/model_hydro_power_coupling/">Model hydro power coupling</a></li><li><a class="tocitem" href="../../how_to/print_the_model/">Print the model</a></li><li><a class="tocitem" href="../../how_to/set_up_representative_days_for_investment_problems/">Set up representative days for investment problems</a></li></ul></li><li><span class="tocitem">Database structure</span><ul><li><a class="tocitem" href="../../concept_reference/the_basics/">Basics of the data structure</a></li><li><a class="tocitem" href="../../concept_reference/archetypes/">Archetypes</a></li></ul></li><li><span class="tocitem">Standard model framework</span><ul><li><a class="tocitem" href="../../advanced_concepts/temporal_framework/">Temporal Framework</a></li><li><a class="tocitem" href="../../advanced_concepts/stochastic_framework/">Stochastic Framework</a></li></ul></li><li><span class="tocitem">Standard model features</span><ul><li><a class="tocitem" href="../../advanced_concepts/unit_commitment/">Unit Commitment</a></li><li><a class="tocitem" href="../../advanced_concepts/investment_optimization/">Investment Optimization</a></li><li><a class="tocitem" href="../../advanced_concepts/reserves/">Reserves</a></li><li><a class="tocitem" href="../../advanced_concepts/ramping/">Ramping</a></li><li><a class="tocitem" href="../../advanced_concepts/Lossless_DC_power_flow/">Lossless nodal DC power flows</a></li><li><a class="tocitem" href="../../advanced_concepts/powerflow/">PTDF-Based Powerflow</a></li><li><a class="tocitem" href="../../advanced_concepts/pressure_driven_gas_transfer/">Pressure driven gas transfer</a></li><li><a class="tocitem" href="../../advanced_concepts/user_constraints/">User Constraints</a></li></ul></li><li><span class="tocitem">Algorithms</span><ul><li><a class="tocitem" href="../../advanced_concepts/decomposition/">Decomposition</a></li><li><a class="tocitem" href="../../advanced_concepts/mga/">Modelling to generate alternatives</a></li><li><a class="tocitem" href="../../advanced_concepts/multi_stage/">Multi-stage optimisation</a></li></ul></li><li><span class="tocitem">SpineOpt Template</span><ul><li><a class="tocitem" href="../../concept_reference/Object Classes/">Object Classes</a></li><li><a class="tocitem" href="../../concept_reference/Relationship Classes/">Relationship Classes</a></li><li><a class="tocitem" href="../../concept_reference/Parameters/">Parameters</a></li><li><a class="tocitem" href="../../concept_reference/Parameter Value Lists/">Parameter Value Lists</a></li></ul></li><li><span class="tocitem">Mathematical Formulation</span><ul><li><a class="tocitem" href="../../mathematical_formulation/variables/">Variables</a></li><li><a class="tocitem" href="../../mathematical_formulation/objective_function/">Objective</a></li><li><a class="tocitem" href="../../mathematical_formulation/constraints_automatically_generated/">Constraints</a></li></ul></li><li><span class="tocitem">Implementation details</span><ul><li><a class="tocitem" href="../../implementation_details/documentation/">Documentation</a></li><li><a class="tocitem" href="../../implementation_details/how_does_the_model_update_itself/">How does the model update itself</a></li><li><a class="tocitem" href="../../implementation_details/how_to_write_a_constraint/">How to write a constraint</a></li><li><a class="tocitem" href="../../implementation_details/time_slices/">Time slices</a></li></ul></li><li><a class="tocitem" href="../../library/">Library</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Stochastic structure</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Stochastic structure</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/spine-tools/SpineOpt.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/spine-tools/SpineOpt.jl/blob/master/docs/src/tutorial/stochastic_system.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Stochastic-structure-tutorial"><a class="docs-heading-anchor" href="#Stochastic-structure-tutorial">Stochastic structure tutorial</a><a id="Stochastic-structure-tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Stochastic-structure-tutorial" title="Permalink"></a></h1><p>Welcome to Spine Toolbox&#39;s Stochastic System tutorial.</p><p>This tutorial provides a step-by-step guide to get started with the stochastic structure. More information can be found in the <a href="../../advanced_concepts/stochastic_framework/#stochastic_framework">documentation on the stochastic structure</a>. It is recommended to make sure you are able to get the simple system tutorial working first.</p><p>In this tutorial we will take a look at independent scenarios and stochastic paths.</p><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p>In theory it is also possible to have different stochastic structures in different parts of your system. In practice that is very much prone to errors. As much of the functionality of different stochastic structures can be accomplished with a clever DAG, it is recommended to work with a single stochastic structure at all times.</p></div></div><h2 id="Setup-starting-from-simple-system-tutorial"><a class="docs-heading-anchor" href="#Setup-starting-from-simple-system-tutorial">Setup starting from simple system tutorial</a><a id="Setup-starting-from-simple-system-tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-starting-from-simple-system-tutorial" title="Permalink"></a></h2><p>We create a new Spine Toolbox project and start from the simple system tutorial.</p><p>For the Spine Toolbox project</p><ul><li>Open Spine Toolbox</li><li>Create a new Spine Toolbox project</li><li>Add two data store items (input and output)<ul><li>set the dialect to sqlite</li><li>push the new database button</li></ul></li><li>Add the run SpineOpt tool<ul><li>connect the databases to the SpineOpt tool</li><li>in the properties pane of the SpineOpt tool,</li></ul>move the available resources to the tool arguments</li></ul><p>For the simple system tutorial</p><ul><li>Download the simple system database (json file)</li></ul><p>from the examples folder in the SpineOpt repository (you can save the json file in your Spine Toolbox project folder)</p><ul><li>Enter the input database such that you are in the spine db editor</li><li>Go to the hamburger menu (Alt+F) and select import</li><li>Locate the downloaded file to import the simple system</li><li>We save our results when we commit to the database,</li></ul><p>so go again to the hamburger menu and select commit. The update message can be something like this: import simple system tutorial.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The graph view is not always enabled by default. If you want to see the simple system, go to the hamburger menu and select graph.</p></div></div><h2 id="Independent-scenarios"><a class="docs-heading-anchor" href="#Independent-scenarios">Independent scenarios</a><a id="Independent-scenarios-1"></a><a class="docs-heading-anchor-permalink" href="#Independent-scenarios" title="Permalink"></a></h2><p>Recall from the simple system tutorial that there actually already is a stochastic structure present. Let us take a closer look at that structure.</p><p><img src="../figs_stochastic/stochastic_system_deterministic_structure.png" alt="image"/></p><p>The scenarios are the labels that are available to the user to label their data. Don&#39;t worry, we&#39;ll come back to that later. Here, there is currently one scenario <em>realization</em>.</p><p>The scenarios are managed by the stochastic structure. Foremost, the stochastic structure is connected to the model with the <em>model__stochastic_structure</em> relationship. The stochastic structure is also connected to different parts of the energy system to manage the stochastic structure in these parts. With the <em>model__default<em>stochastic</em>structure</em> relationship we can connect the scenario to the entire energy system. Here, there is one stochastic structure <em>deterministic</em> which is also the systems default.</p><p>It is quite simple to add an independent scenario to this existing stochastic structure.</p><ul><li>Add a <em>scenario</em> object and call it &#39;independent&#39;</li><li>Add a <em>stochastic_structure__stochastic_scenario</em> relationship between <em>independent</em> and <em>deterministic</em></li></ul><p>either from the tree view (right click -&gt; new relationship) or from the graph view (right click -&gt; add relationship)</p><p><img src="../figs_stochastic/stochastic_system_independent.png" alt="image"/></p><p>Now we can use these labels in the values for the energy system.</p><ul><li>Change the <em>demand</em> parameter at the <em>electricity_node</em> from 150.0 to a map</li></ul><p>(right click -&gt; edit, parameter type map)</p><ul><li>for the <em>x</em> column we can use our scenario labels, for the <em>Value</em> column we can choose our values</li><li>Choose realization 150.0 and independent 100.0</li><li>Save/Commit the results</li></ul><p><img src="../figs_stochastic/stochastic_system_independent_map.png" alt="image"/></p><p>That is it! We can now run the model and the output database will show the results for both scenarios. In the realization scenario power plant b produces an output of 50. In the independent scenario power plant b does not produce anything as the demand is low enough for power plant a to produce all the necessary energy.</p><h2 id="Stochastic-path"><a class="docs-heading-anchor" href="#Stochastic-path">Stochastic path</a><a id="Stochastic-path-1"></a><a class="docs-heading-anchor-permalink" href="#Stochastic-path" title="Permalink"></a></h2><p>SpineOpt always works with stochastic paths. The stochastic path describes which scenario is active at each time step. There can be multiple stochastic paths in parallel. The stochastic structure collects the stochastic paths in a direct acyclic graph (DAG).</p><p>But let&#39;s make that more clear with an example. We can continue from the previous structure, but let&#39;s rename the structure and scenarios. (optional step)</p><ul><li>Right click the object (either in the tree view or the graph view) and select <em>edit</em></li><li>Rename the stochastic structure from <em>deterministic</em> to <em>DAG</em></li><li>Rename the <em>realization</em> scenario to <em>base</em></li><li>Rename the <em>independent</em> scenario to <em>forecast1</em></li></ul><p>Perhaps from the name you already guessed it, we are going to add some scenarios.</p><ul><li>Add two scenario objects <em>forecast2</em> and <em>forecast3</em></li><li>Connect the two scenarios to stochastic structure</li></ul><p>And we need to adjust the map for the electricity demand accordingly.</p><ul><li>Edit the map and provide a value for each scenario</li></ul><p>(see image below)</p><p><img src="../figs_stochastic/stochastic_system_dag_map.png" alt="image"/></p><p>All these scenarios are independently available to the stochastic structure but now we want to define the underlying relationships to make a stochastic path. In particular, we want to start from a base scenario and later split in the forecast scenarios. For SpineOpt that means that the base scenario is the parent scenario and the following forecast scenarios are the child scenarios.</p><ul><li>add the <em>parent_stochastic_structure__child_stochastic_structure</em></li></ul><p>for each forecast scenario and select the base scenario as its parent (the first scenario is the parent scenario and the second scenario is its child)</p><p><img src="../figs_stochastic/stochastic_system_dag_parent_child.png" alt="image"/></p><p>We also need to tell SpineOpt what the probability is that we end up in a certain child. That information is stored in the stochastic structure so you&#39;ll find the corresponding parameter in the <em>stochastic_structure__stochastic_scenario</em> relationship. Here we assume that each forecast is equally likely to happen.</p><ul><li>for each DAG | forecast relationship, add a value for</li></ul><p>the <em>weight_relative_to_parent</em> parameter; the sum needs to be equal to 1</p><p><img src="../figs_stochastic/stochastic_system_dag_weight.png" alt="image"/></p><p>That results in the stochastic structure below.</p><p><img src="../figs_stochastic/stochastic_system_dag.png" alt="image"/></p><p>We can run the SpineOpt tool on this database but we will only see the values for the base scenario. That is because SpineOpt assumes that a scenario runs forever. So, we need to tell SpineOpt when the base scenario ends.</p><ul><li>The current resolution of the system is 1D</li></ul><p>but we need a higher resolution if we want to switch scenarios. So, set the resolution parameter of the temporal block flat to 1h.</p><ul><li>To end the base structure after 6 h,</li></ul><p>we go to the DAG | base relationship and set the parameter <em>stochastic_scenario_end</em> to a 6h duration value (to obtain a duration value we need to right click the value field and select the parameter type duration)</p><p>Do not forget to save/commit from time to time.</p><p>When we run the model now, we will obtain values for all scenarios.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>For the sake of completion we will also tell you what to do when you want converge the forecasts into an end scenario.</p><ul><li>add a scenario called <em>end</em></li><li>map the end scenario for the electricity demand to the value 200.0</li><li>connect the end scenario to the stochastic structure</li><li>connect the end scenario to each of the forecasts,</li></ul><p>where the forecasts are considered as the parents</p><ul><li>set the weight of the end scenario to 1</li><li>let the forecasts scenarios end after a duration of 16 hours</li></ul><p><img src="../figs_stochastic/stochastic_system_dag_converge.png" alt="image"/></p></div></div><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>The <em>stochastic_scenario_end</em> parameter starts counting from the start of the simulation! In the examples above, when the base scenario has a duration of 6h and the forecast scenarios have a duration of 16h, the forecast scenarios will only be active for 10 hours between hour 6 and hour 16!</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../temporal_resolution/">« Temporal resolution</a><a class="docs-footer-nextpage" href="../capacity_planning/">Capacity planning »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.6.0 on <span class="colophon-date" title="Thursday 29 August 2024 10:48">Thursday 29 August 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
