<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Two hydro plants · SpineOpt.jl</title><meta name="title" content="Two hydro plants · SpineOpt.jl"/><meta property="og:title" content="Two hydro plants · SpineOpt.jl"/><meta property="twitter:title" content="Two hydro plants · SpineOpt.jl"/><meta name="description" content="Documentation for SpineOpt.jl."/><meta property="og:description" content="Documentation for SpineOpt.jl."/><meta property="twitter:description" content="Documentation for SpineOpt.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/style.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="SpineOpt.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">SpineOpt.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../getting_started/installation/">Installation</a></li><li><a class="tocitem" href="../../getting_started/setup_workflow/">Setting up a workflow</a></li><li><a class="tocitem" href="../../getting_started/creating_your_own_model/">Creating Your Own Model</a></li><li><a class="tocitem" href="../../getting_started/archetypes/">Archetypes</a></li><li><a class="tocitem" href="../../getting_started/output_data/">Managing Outputs</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../webinars/">Webinars</a></li><li><a class="tocitem" href="../simple_system/">Simple system</a></li><li><a class="tocitem" href="../reserves/">Reserve requirements</a></li><li><a class="tocitem" href="../ramping/">Ramping constraints</a></li><li><a class="tocitem" href="../unit_commitment/">Unit Commitment</a></li><li class="is-active"><a class="tocitem" href>Two hydro plants</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Setting-up-a-Basic-Hydropower-Model"><span>Setting up a Basic Hydropower Model</span></a></li><li><a class="tocitem" href="#Maximisation-of-Stored-Water"><span>Maximisation of Stored Water</span></a></li><li><a class="tocitem" href="#Spillage-Constraints-Minimisation-of-Spilt-Water"><span>Spillage Constraints - Minimisation of Spilt Water</span></a></li><li><a class="tocitem" href="#Follow-Contracted-Load-Curve"><span>Follow Contracted Load Curve</span></a></li></ul></li><li><a class="tocitem" href="../case_study_a5/">Case Study A5</a></li></ul></li><li><span class="tocitem">How to</span><ul><li><a class="tocitem" href="../../how_to/change_the_solver/">Change the solver</a></li><li><a class="tocitem" href="../../how_to/define_an_efficiency/">Define an efficiency</a></li><li><a class="tocitem" href="../../how_to/print_the_model/">Print the model</a></li></ul></li><li><span class="tocitem">Concept Reference</span><ul><li><a class="tocitem" href="../../concept_reference/the_basics/">Basics of the model structure</a></li><li><a class="tocitem" href="../../concept_reference/Object Classes/">Object Classes</a></li><li><a class="tocitem" href="../../concept_reference/Relationship Classes/">Relationship Classes</a></li><li><a class="tocitem" href="../../concept_reference/Parameters/">Parameters</a></li><li><a class="tocitem" href="../../concept_reference/Parameter Value Lists/">Parameter Value Lists</a></li></ul></li><li><span class="tocitem">Mathematical Formulation</span><ul><li><a class="tocitem" href="../../mathematical_formulation/variables/">Variables</a></li><li><a class="tocitem" href="../../mathematical_formulation/constraints_automatically_generated/">Constraints</a></li><li><a class="tocitem" href="../../mathematical_formulation/objective_function/">Objective</a></li></ul></li><li><span class="tocitem">Advanced Concepts</span><ul><li><a class="tocitem" href="../../advanced_concepts/temporal_framework/">Temporal Framework</a></li><li><a class="tocitem" href="../../advanced_concepts/stochastic_framework/">Stochastic Framework</a></li><li><a class="tocitem" href="../../advanced_concepts/unit_commitment/">Unit Commitment</a></li><li><a class="tocitem" href="../../advanced_concepts/ramping/">Ramping</a></li><li><a class="tocitem" href="../../advanced_concepts/reserves/">Reserves</a></li><li><a class="tocitem" href="../../advanced_concepts/investment_optimization/">Investment Optimization</a></li><li><a class="tocitem" href="../../advanced_concepts/user_constraints/">User Constraints</a></li><li><a class="tocitem" href="../../advanced_concepts/decomposition/">Decomposition</a></li><li><a class="tocitem" href="../../advanced_concepts/powerflow/">PTDF-Based Powerflow</a></li><li><a class="tocitem" href="../../advanced_concepts/pressure_driven_gas_transfer/">Pressure driven gas transfer</a></li><li><a class="tocitem" href="../../advanced_concepts/Lossless_DC_power_flow/">Lossless nodal DC power flows</a></li><li><a class="tocitem" href="../../advanced_concepts/representative_days_w_seasonal_storage/">Representative days with seasonal storages</a></li><li><a class="tocitem" href="../../advanced_concepts/cumulated_flow_restrictions/">Imposing renewable energy targets</a></li><li><a class="tocitem" href="../../advanced_concepts/mga/">Modelling to generate alternatives</a></li><li><a class="tocitem" href="../../advanced_concepts/multi_stage/">Multi-stage optimisation</a></li></ul></li><li><span class="tocitem">Implementation details</span><ul><li><a class="tocitem" href="../../implementation_details/documentation/">Documentation</a></li><li><a class="tocitem" href="../../implementation_details/how_does_the_model_update_itself/">How does the model update itself</a></li><li><a class="tocitem" href="../../implementation_details/how_to_write_a_constraint/">How to write a constraint</a></li><li><a class="tocitem" href="../../implementation_details/time_slices/">Time slices</a></li></ul></li><li><a class="tocitem" href="../../library/">Library</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Two hydro plants</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Two hydro plants</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/spine-tools/SpineOpt.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/spine-tools/SpineOpt.jl/blob/master/docs/src/tutorial/tutorialTwoHydro.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Hydro-Power-Planning"><a class="docs-heading-anchor" href="#Hydro-Power-Planning">Hydro Power Planning</a><a id="Hydro-Power-Planning-1"></a><a class="docs-heading-anchor-permalink" href="#Hydro-Power-Planning" title="Permalink"></a></h1><p>Welcome to this Spine Toolbox tutorial for building hydro power planning models. The tutorial guides you through the implementation of different ways of modelling hydrodologically-coupled hydropower systems.</p><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>This tutorial aims at demonstrating how we can model a hydropower system in Spine (<em>SpineOpt.jl</em> and <em>Spine-Toolbox</em>) with different assumptions and goals. It starts off by setting up a simple model of system of two hydropower plants and gradually introduces additional features. The goal of the model is to capture the combined operation of two hydropower plants (Språnget and Fallet) that operate on the same river as shown in the picture bellow. Each power plant has its own reservoir and generates electricity by discharging water. The plants might need to spill water, i.e., release water from their reservoirs without generating electricity, for various reasons. The water discharged or spilled by the upstream power plant follows the river route and becomes available to the downstream power plant.</p><p><img src="../figs_two_hydro/two_hydro.png" alt="A system of two hydropower plants."/></p><p><em>A system of two hydropower plants</em></p><p>In order to run this tutorial you must first execute some preliminary steps from the <a href="../simple_system/">Simple System</a> tutorial. Specifically, execute all steps from the <a href="../simple_system/#guide">guide</a>, up to and including the step of <a href="../simple_system/#importing-the-spineopt-database-template">importing-the-spineopt-database-template</a>. It is advisable to go through the whole tutorial in order to familiarise yourself with Spine.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Just remember to give a different name for the Spine Project of the hydropower tutorial (e.g., ‘Two_hydro’) in the corresponding step, so to not mix up the Spine Toolbox projects!</p></div></div><p>That is all you need at the moment, you can now start inserting the data.</p><h2 id="Setting-up-a-Basic-Hydropower-Model"><a class="docs-heading-anchor" href="#Setting-up-a-Basic-Hydropower-Model">Setting up a Basic Hydropower Model</a><a id="Setting-up-a-Basic-Hydropower-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-up-a-Basic-Hydropower-Model" title="Permalink"></a></h2><p>For creating a SpineOpt model you need to create <em>Objects</em>, <em>Relationships</em> (associating the objects), and in some cases, parameters values accompanying them. To do this, open the input database using the Spine DB Editor (double click on the input database in the <em>Design View</em> pane of Spine Toolbox).</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>To save your work in the Spine DB Editor you need to <em>commit</em> your changes (please check the Simple System tutorial for how to do that). As a good practice, you should commit often as you enter the data in the model to avoid data loss.</p></div></div><h3 id="Defining-objects"><a class="docs-heading-anchor" href="#Defining-objects">Defining objects</a><a id="Defining-objects-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-objects" title="Permalink"></a></h3><h4 id="Commodities"><a class="docs-heading-anchor" href="#Commodities">Commodities</a><a id="Commodities-1"></a><a class="docs-heading-anchor-permalink" href="#Commodities" title="Permalink"></a></h4><p>Since we are modelling a hydropower system we will have to define two commodities, water and electricity. In the Spine DB editor, locate the <em>Object tree</em>, expand the root element if required, right click on the commodity class, and select <em>Add objects</em> from the context menu. In the <em>Add objects</em> dialogue that should pop up, enter the object names for the commodities as you see in the image below and then press Ok.</p><p><img src="../figs_two_hydro/two_hydro_commodities.png" alt="image"/></p><p><em>Defining commodities.</em></p><h4 id="Nodes"><a class="docs-heading-anchor" href="#Nodes">Nodes</a><a id="Nodes-1"></a><a class="docs-heading-anchor-permalink" href="#Nodes" title="Permalink"></a></h4><p>Follow a similar path to add nodes, right click on the node class, and select <em>Add objects</em> from the context menu. In the dialogue, enter the node names as shown:</p><p><img src="../figs_two_hydro/two_hydro_nodes.png" alt="image"/></p><p><em>Defining nodes.</em></p><p>Nodes in SpineOpt are used to balance commodities. As you noticed, we defined two nodes for each hydropower station (water nodes) and a single electricity node. This is one possible way to model the hydropower plant operation. This will become clearer in the next steps, but in a nutshell, the <em>upper</em> node represents the water arriving at each plant, while the <em>lower</em> node represents the water that is discharged and becomes available to the next plant.</p><h4 id="Connections"><a class="docs-heading-anchor" href="#Connections">Connections</a><a id="Connections-1"></a><a class="docs-heading-anchor-permalink" href="#Connections" title="Permalink"></a></h4><p>Similarly, add connections, right click on the connection class, select <em>Add objects</em> from the context menu and add the following connections:</p><p><img src="../figs_two_hydro/two_hydro_connections.png" alt="image"/></p><p><em>Defining connections.</em></p><p>Connections enable the nodes to interact. Since, for each plant we need to model the amount of water that is discharged and the amount that is spilled, we must define two connections accordingly. When defining relationships we shall associate the connections with the nodes.</p><h4 id="Units"><a class="docs-heading-anchor" href="#Units">Units</a><a id="Units-1"></a><a class="docs-heading-anchor-permalink" href="#Units" title="Permalink"></a></h4><p>To convert from one type of commodity associated with one node to another, you need a unit. You guessed it! Right click on the unit class, select <em>Add objects</em> from the context menu and add the following units:</p><p><img src="../figs_two_hydro/two_hydro_units.png" alt="image"/></p><p><em>Defining units.</em></p><p>We have defined one unit for each hydropower plant that converts water to electricity and an additional unit that we will use to model the income from selling the electricity production in the electricity market.</p><h3 id="Relationships"><a class="docs-heading-anchor" href="#Relationships">Relationships</a><a id="Relationships-1"></a><a class="docs-heading-anchor-permalink" href="#Relationships" title="Permalink"></a></h3><h4 id="Assinging-commodities-to-nodes"><a class="docs-heading-anchor" href="#Assinging-commodities-to-nodes">Assinging commodities to nodes</a><a id="Assinging-commodities-to-nodes-1"></a><a class="docs-heading-anchor-permalink" href="#Assinging-commodities-to-nodes" title="Permalink"></a></h4><p>Since we have defined more than one commodities, we need to assign them to nodes. In the Spine DB editor, locate the <em>Relationship tree</em>, expand the root element if required, right click on the <em>node__commodity</em> class, and select <em>Add relationships</em> from the context menu. In the <em>Add relationships</em> dialogue, enter the following relationships as you see in the image below and then press Ok.</p><p><img src="../figs_two_hydro/two_hydro_node_commodities.png" alt="image"/></p><p><em>Introducing node__commodity relationships.</em></p><h4 id="Associating-connections-to-nodes"><a class="docs-heading-anchor" href="#Associating-connections-to-nodes">Associating connections to nodes</a><a id="Associating-connections-to-nodes-1"></a><a class="docs-heading-anchor-permalink" href="#Associating-connections-to-nodes" title="Permalink"></a></h4><p>Next step is to define the topology of flows between the nodes. To do that insert the following relationships in the <em>connection__from_node</em> class:</p><p><img src="../figs_two_hydro/two_hydro_connection_from_node.png" alt="image"/></p><p><em>Introducing connection__from_node relationships.</em></p><p>as well as the following the following <em>connection__node_node</em> relationships as you see in the figure:</p><p><img src="../figs_two_hydro/two_hydro_connection_node_node.png" alt="Introducing connection__node_node relationships."/></p><p><em>Introducing connection__node_node relationships.</em></p><h4 id="Placing-the-units-in-the-model"><a class="docs-heading-anchor" href="#Placing-the-units-in-the-model">Placing the units in the model</a><a id="Placing-the-units-in-the-model-1"></a><a class="docs-heading-anchor-permalink" href="#Placing-the-units-in-the-model" title="Permalink"></a></h4><p>To define the topology of the units and be able to introduce their parameters later on, you need to define the following relationships in the <em>unit__from_node</em> class:</p><p><img src="../figs_two_hydro/two_hydro_unit_from_node.png" alt="Introducing unit__from_node relationships."/></p><p><em>Introducing unit__from_node relationships.</em></p><p>in the <em>unit__node_node</em> class:</p><p><img src="../figs_two_hydro/two_hydro_unit_node_node.png" alt="Introducing unit__node_node relationships."/></p><p><em>Introducing unit__node_node relationships.</em></p><p>and in the <em>unit__to_node</em> class as you see in the following figure:</p><p><img src="../figs_two_hydro/two_hydro_unit_to_node.png" alt="Introducing unit__to_node relationships."/></p><p><em>Introducing unit__to_node relationships.</em></p><h4 id="Defining-the-report-outputs"><a class="docs-heading-anchor" href="#Defining-the-report-outputs">Defining the report outputs</a><a id="Defining-the-report-outputs-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-the-report-outputs" title="Permalink"></a></h4><p>To force Spine to export the optimal values of the optimization variables to the output database you need to specify them in the form of <em>report_output</em> relationships. Add the following relationships to the <em>report_output</em> class:</p><p><img src="../figs_two_hydro/two_hydro_report.png" alt="Introducing report outputs with report_output relationships."/></p><p><em>Introducing report outputs with report_output relationships.</em></p><h3 id="Objects-and-Relationships-parameter-values"><a class="docs-heading-anchor" href="#Objects-and-Relationships-parameter-values">Objects and Relationships parameter values</a><a id="Objects-and-Relationships-parameter-values-1"></a><a class="docs-heading-anchor-permalink" href="#Objects-and-Relationships-parameter-values" title="Permalink"></a></h3><h4 id="Defining-model-parameter-values"><a class="docs-heading-anchor" href="#Defining-model-parameter-values">Defining model parameter values</a><a id="Defining-model-parameter-values-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-model-parameter-values" title="Permalink"></a></h4><p>The specify modelling properties of both objects and relationships you need to introduce respective parameter values. To introduce object parameter values first select the <em>model</em> class in the Object tree and enter the following values in the <em>Object parameter value</em> pane:</p><p><img src="../figs_two_hydro/two_hydro_model_parameters.png" alt="Defining model execution parameters."/></p><p><em>Defining model execution parameters.</em></p><p>Observe the difference between the <em>Object parameter value</em> and the <em>Object parameter definition</em> sub-panes of the <em>Object parameter value</em> pane. The first one is for the modeller to introduce values for specific parameters, while the second one holds the definition of all available parameters with their default values (these are overwritten when the user introduces their own values). Feel free to explore the different parameters and their default values. While entering data in each row you will also observe that, in most cases, clicking on each cell activates a drop-down list of elements that the user must choose from. In the case of the <em>value</em> cells, however, unless you need to input a scalar value or a string, you should right-click on the cell and select edit for specifying the data type of the parameter value. As you see in the figure above, for the first <em>duration_unit</em> parameter you is of type string, while the <em>model_start</em> and <em>model_end</em> parameters are of type Date time. The Date time parameters can be edited by right-clicking on the corresponding <em>value</em> cells, selecting <em>Edit</em>, and then inserting the Date time values that you see in the figure above in the <em>Datetime</em> field using the correct format.</p><h4 id="Defining-node-parameter-values"><a class="docs-heading-anchor" href="#Defining-node-parameter-values">Defining node parameter values</a><a id="Defining-node-parameter-values-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-node-parameter-values" title="Permalink"></a></h4><p>Going back to hydropower modelling, we need to specify several parameters for the nodes of the systems. In the same pane as before, but this time selecting the <em>node</em> class from the <em>Object tree</em>, we need to add the following entries:</p><p><img src="../figs_two_hydro/two_hydro_node_parameters.png" alt="Defining model execution parameters."/></p><p><em>Defining model execution parameters.</em></p><p>Before we go through the interpretation of each parameter, click on the following link for each <em>fix_node_state</em> parameter (<a href="https://raw.githubusercontent.com/spine-tools/Spine-Toolbox/master/docs/source/data/Spranget_node.txt">Node state Språnget</a>, <a href="https://raw.githubusercontent.com/spine-tools/Spine-Toolbox/master/docs/source/data/Fallet_node.txt">Node state Fallet</a>), select all, copy the data and then paste them directly in the respective parameter value cell. Spine should automatically detect and input the timeseries data as a parameter value. The data type for those entries should be <em>Timeseries</em> as shown in the figure above. Alternatively, you can select the data type as <em>Timeseries</em> and manually insert the data (values with their corresponding datetimes).</p><p>To model the reservoirs of each hydropower plant, we leverage the <em>state</em> feature that a node can have to represent storage capability. We only need to do this for one of the two nodes that we have used to model each plant and we choose the <em>upper</em> level node. To define storage, we set the value of the parameter <em>has_state</em> as True (be careful to not set it as a string but select the boolean true value by right clicking and selecting Edit in the respective cells). This activates the storage capability of the node. Then, we need to set the capacity of the reservoir by setting the <em>node_state_cap</em> parameter value. Finally, we fix the initial and final values of the reservoir by setting the parameter <em>fix_node_state</em> to the respective values (we introduce <em>nan</em> values for the time steps that we don&#39;t want to impose such constraints). To model the local inflow we use the <em>demand</em> parameter but using the negated value of the actual inflow, due to the definition of the parameter in Spine as a <strong>demand</strong>.</p><h4 id="Defining-the-temporal-resolution-of-the-model"><a class="docs-heading-anchor" href="#Defining-the-temporal-resolution-of-the-model">Defining the temporal resolution of the model</a><a id="Defining-the-temporal-resolution-of-the-model-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-the-temporal-resolution-of-the-model" title="Permalink"></a></h4><p>Spine automates the creation of the temporal resolution of the optimization model and even supports different temporal resolutions for different parts of the model. To define a model with an hourly resolution we select the <em>temporal_block</em> class in the <em>Object tree</em> and we set the <em>resolution</em> parameter value to <em>1h</em> as shown in the figure:</p><p><img src="../figs_two_hydro/two_hydro_temporal_block.png" alt="Setting the temporal resolution of the model."/></p><p><em>Setting the temporal resolution of the model.</em></p><h4 id="Defining-connection-parameter-values"><a class="docs-heading-anchor" href="#Defining-connection-parameter-values">Defining connection parameter values</a><a id="Defining-connection-parameter-values-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-connection-parameter-values" title="Permalink"></a></h4><p>The water that is discharged from Språnget will flow from <em>Språnget_lower</em> node to <em>Fallet_upper</em> through the <em>Språnget_to_Fallet_disc</em> connection, while the water that is spilled will flow from <em>Språnget_upper</em> directly to to <em>Fallet_upper</em> through the <em>Språnget_to_Fallet_spill</em> connection. To model this we need to select the <em>connection__node_node</em> class in the Relationship tree and add the following entries in the <em>Relationship parameter value</em> pane, as shown next:</p><p><img src="../figs_two_hydro/two_hydro_connection_node_node_parameters.png" alt="Defining discharge and spillage ratio flows."/></p><p><em>Defining discharge and spillage ratio flows.</em></p><h4 id="Defining-unit-parameter-values"><a class="docs-heading-anchor" href="#Defining-unit-parameter-values">Defining unit parameter values</a><a id="Defining-unit-parameter-values-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-unit-parameter-values" title="Permalink"></a></h4><p>Similarly, for each one of the <em>unit__from_node</em>, <em>unit__node_node</em>, and <em>unit__to_node</em> relationship classes we need to add the the maximal water that can be discharged by each hydropower plant:</p><p><img src="../figs_two_hydro/two_hydro_unit_from_node_parameters.png" alt="Setting the maximal water discharge of each plant."/></p><p><em>Setting the maximal water discharge of each plant.</em></p><p>To define the income from selling the produced electricity we use the <em>vom_cost</em> parameter and negate the values of the electricity prices. To automatically insert the timeseries data in Spine, click on the <a href="https://raw.githubusercontent.com/spine-tools/Spine-Toolbox/master/docs/source/data/el_prices.txt">Electricity prices timeseries</a>, select all values, copy, and paste them, after having selected the value cell of the corresponding row. You can plot and edit the timeseries data by double clicking on the same cell afterwards:</p><p><img src="../figs_two_hydro/two_hydro_vom_cost.png" alt="Previewing and editing the electricity prices timeseries."/></p><p><em>Previewing and editing the electricity prices timeseries.</em></p><p>Carrying on with our hydropower model we must define the conversion ratios between the nodes. Assuming that water is not &quot;lost&quot; from the <em>upper</em> node toward the <em>lower</em> node and electricity is produced with the discharged water with a given efficiency we define the following parameter values for each hydropower plant, in the <em>unit__node_node</em> class:</p><p><img src="../figs_two_hydro/two_hydro_unit_node_node_parameters.png" alt="Defining conversion efficiencies."/></p><p><em>Defining conversion efficiencies.</em></p><p>Lastly, we can define the maximal electricity production of each plant by inserting the following <em>unit__to_node</em> relationship parameter values:</p><p><img src="../figs_two_hydro/two_hydro_unit_to_node_parameters.png" alt="Setting the maximal electricity production of each plant."/></p><p><em>Setting the maximal electricity production of each plant.</em></p><p>Hooray! You can now commit the database, close the Spine DB Editor and run your model! Go to the main Spine window and click on Execute <img src="../figs_a5/play-circle.png" alt="image"/>.</p><h3 id="Examining-the-results"><a class="docs-heading-anchor" href="#Examining-the-results">Examining the results</a><a id="Examining-the-results-1"></a><a class="docs-heading-anchor-permalink" href="#Examining-the-results" title="Permalink"></a></h3><p>Select the output data store and open the Spine DB editor. To quickly plot some results, you can expand the unit class in the Object tree and select the <em>electricity_load</em> unit. In the <em>Relationship parameter value</em> pane double click on the value cell of</p><blockquote><p><strong>report1 | electricity_load | electricity_node | from_node | realization</strong></p></blockquote><p>object name. This will open a plotting window from were you can also examine closer and retrieve the data, as shown in the next figure. The <em>unit_flow</em> variable of the <em>electricity_load</em> unit represents the total electricity production in the system:</p><p><img src="../figs_two_hydro/two_hydro_results_electricity.png" alt="Total electricity produced in the system."/></p><p><em>Total electricity produced in the system.</em></p><p>Now, take to a minute to reflect on how you could retrieve the data representing the water that is discharged by each hydropower plant as shown in the next figure:</p><p><img src="../figs_two_hydro/two_hydro_results_discharge.png" alt="Water discharge of Språnget hydropower plant."/></p><p><em>Water discharge of Språnget hydropower plant.</em></p><p>The right answer is that you need to select some hydropower plant (e.g., Språnget) and then double-click on the value cell of the object name</p><blockquote><p><strong>report1 | Språnget_pwr_plant | Språnget_lower | to_node | realization</strong></p></blockquote><p>or</p><blockquote><p><strong>report1 | Språnget_pwr_plant | Språnget_upper | from_node | realization</strong></p></blockquote><p>It could be useful to also reflect on why these objects give the same results, and what do the results from the third element represent. (Hint: observe the <em>to_</em> or <em>from_</em> directions in the object names). As an exercise, you can try to retrieve the timeseries data for spilled water as well as the water levels at the reservoir of each hydropower plant.</p><p>You can further explore the model, or make changes in the input database to observe how these affect the results, e.g., you can use different electricity prices, values for the reservoir capacity (and initialization points), as well as change the temporal resolution of the model. All you need to do is commit the changes and run your model. Every time that you run the model, your results are appended in the output database with an execution timestamp. You can however filter your results per execution, by selecting the <em>Alternative</em> that you want from the <em>Alternative/Scenario tree</em> pane. You can use the exporter too to export specific variables in an Excel sheet. Alternatively, you can export all the data of the output database by going to the main menu (Press <strong>Alt + F</strong> to display it), selecting <strong>File -&gt; Export</strong>, then select the items that you want, click ok and export the data in Excel, or json format.</p><p>In the following, we extend this simple hydropower system to include more elaborate modelling choices.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>In each of the next sections, we perform incremental changes to the initial simple hydropower model. If you want to keep the database that you created, you can duplicate the database file (right-click on the input database and select <strong>Duplicate and duplicate files</strong>) and perform the changes in the new database. You need to configure the workflow accordingly in order to run the database you want (please check the Simple System tutorial for how to do that).</p></div></div><h2 id="Maximisation-of-Stored-Water"><a class="docs-heading-anchor" href="#Maximisation-of-Stored-Water">Maximisation of Stored Water</a><a id="Maximisation-of-Stored-Water-1"></a><a class="docs-heading-anchor-permalink" href="#Maximisation-of-Stored-Water" title="Permalink"></a></h2><p>Instead of fixing the water content of the reservoirs at the end of the planning period, we can consider that the remaining water in the reservoirs has a value and then maximize the value along with the revenues for producing electricity within the planning horizon. This objective term is often called the <strong>Value of stored water</strong> and we can approximate it by assuming that this water will be used to generate electricity in the future that would be sold at a forecasted price. The water stored in the upstream hydropower plant will become also available to the downstream plant and this should be taken into account.</p><p>To model the value of stored water we need to make some additions and modifications to the initial model.</p><ul><li><p>First, add a new node (see <a href="../../#Nodes">adding nodes</a>) and give it a   name (e.g., <em>stored_water</em>). This   node will accumulate the water stored in the reservoirs at the end   of the planning horizon. Associate the node with the water   commodity (see <a href="../../#Assinging-commodities-to-nodes">node__commodity</a>).</p></li><li><p>Add three more units (see <a href="../../#Units">adding units</a>); two will   transfer the water at the end of the planning horizon in the new   node that we just added (e.g., <em>Språnget_stored_water</em>, <em>Fallet_stored_water</em>), and one will be   used as a <em>sink</em> introducing the   value of stored water in the objective function (e.g., <em>value_stored_water</em>).</p></li><li><p>To establish the topology of the new units and nodes (see   <a href="../../#Placing-the-units-in-the-model">adding unit relationships</a>):</p><ul><li>add one <em>unit__from_node</em> relationship, between the   <em>value_stored_water</em> unit from the <em>stored_water</em> node, another one between   the <em>Språnget_stored_water</em> unit from   the <em>Språnget_upper</em> node and one for   <em>Faller_stored_water</em> from <em>Fallet_upper</em>.</li><li>add one <em>unit__node__node</em>   relationship between the <em>Språnget_stored_water</em> unit with the   <em>stored_water</em> and <em>Språnget_upper</em> nodes and another one   for <em>Fallet_stored_water</em> unit   with the <em>stored_water</em> and <em>Fallet_upper</em> nodes,</li><li>add a <em>unit__to_node</em>   relationship between the <em>Fallet_stored_water</em> and the <em>stored_water</em> node and another one   between the <em>Språnget_stored_water</em> unit and the   <em>stored_water</em> node.</li></ul></li><li><p>Now we need to make some changes in object parameter values.</p><ul><li>Extend the planning horizon of the model by one hour, i.e.,   change the <em>model_end</em> parameter   value to <em>2021-01-02T01:00:00</em>   (right-click on the value cell, click edit and paste the new   datetime in the popup window).</li><li>Remove the <em>fix_node_state</em>   parameter values for the end of the optimization horizon as   you seen in the following figure: double click on the <em>value</em> cell of the <em>Språnget_upper</em> and <em>Fallet_upper</em> nodes, select the third   data row, right-click, select <em>Remove   rows</em>, and click OK.</li><li>Add an electricity price for the extra hour. Enter the   parameter <em>vom_cost</em> on the <em>unit__from_node</em> relationship   between the <em>electricity_node</em>   and the <em>electricity_load</em> and   set 0 as the price of electricity for the last hour <em>2021-01-02T00:00:00</em>. The price is set   to zero to ensure no electricity is sold during this hour.</li></ul><p><img src="../figs_two_hydro/two_hydro_fix_node_state.png" alt="Modify the fix_node_state parameter value of Språnget_upper and Fallet_upper nodes."/>   <em>Modify the fix_node_state parameter value of Språnget_upper and Fallet_upper nodes.</em></p></li><li><p>Finally, we need to add some relationship parameter values for the   new units:</p><ul><li>Add a <em>vom_cost</em> parameter value   on a <em>value_stored_water|stored_water</em>   instance of a <em>unit__from_node</em>   relationship, as you see in the figure bellow. For the   timeseries you can copy-paste the data directly from <a href="https://raw.githubusercontent.com/spine-tools/Spine-Toolbox/master/docs/source/data/value_stored_water_vom.txt">this   link</a>.   If you examine the timeseries data you&#39;ll notice that we have   imposed a zero cost for all the optimisation horizon, while we   use an assumed future electricity value for the additional   time step at the end of the horizon. </li></ul><p><img src="../figs_two_hydro/two_hydro_max_stored_water_unit_values.png" alt="Adding vom_cost parameter value on the value_stored_water unit."/>   <em>Adding vom_cost parameter value on the value_stored_water unit.</em></p><ul><li>Add two <em>fix_ratio_out_in_unit_flow</em> parameter   values as you see in the figure bellow. The efficiency of   <em>Fallet_stored_water</em> is the same   as the <em>Fallet_pwr_plant</em> as the   water in Fallet&#39;s reservoir will be used to produce   electricity by the the Fallet plant only. On the other hand,   the water from Språnget&#39;s reservoir will be used both by   Fallet and Språnget plant, therefore we use the sum of the two   efficiencies in the parameter value of <em>Språnget_stored_water</em>.</li></ul><p><img src="../figs_two_hydro/two_hydro_max_stored_water_unit_node_node.png" alt="Adding fix_ratio_out_in_unit_flow parameter values on the Språnget_stored_water and Fallet_stored_water units."/>   <em>Adding fix_ratio_out_in_unit_flow parameter values on the Språnget_stored_water and Fallet_stored_water units.</em></p></li></ul><p>You can now commit your changes in the database, execute the project and <a href="../../#Examining-the-results">examine the results</a>! As an exercise, try to retrieve the value of stored water as it is calculated by the model.</p><h2 id="Spillage-Constraints-Minimisation-of-Spilt-Water"><a class="docs-heading-anchor" href="#Spillage-Constraints-Minimisation-of-Spilt-Water">Spillage Constraints - Minimisation of Spilt Water</a><a id="Spillage-Constraints-Minimisation-of-Spilt-Water-1"></a><a class="docs-heading-anchor-permalink" href="#Spillage-Constraints-Minimisation-of-Spilt-Water" title="Permalink"></a></h2><p>It might be the case that we need to impose certain limits to the amount of water that is spilt on each time step of the planning horizon, e.g., for environmental reasons, there can be a minimum and a maximum spillage level. At the same time, to avoid wasting water that could be used for producing electricity, we could explicitly impose the spillage minimisation to be added in the objective function.</p><ul><li><p>Add one unit (see <a href="../../#Units">adding units</a>) to impose the spillage   constraints to each plant and name it (for example <em>Språnget_spill</em>).</p></li><li><p>Remove the <em>Språnget_to_Fallet_spill</em>   connection (in the Object tree expand the connection class,   right-click on <em>Språnget_to_Fallet_spill</em>, and the click   <strong>Remove</strong>).</p></li><li><p>To establish the topology of the unit (see   <a href="../../#Placing-the-units-in-the-model">adding unit relationships</a>):</p><ul><li>Add a <em>unit__from_node</em>   relationship, between the <em>Språnget_spill</em> unit from the <em>Språnget_upper</em> node,</li><li>add a <em>unit__node__node</em>   relationship between the <em>Språnget_spill</em> unit with the <em>Fallet_upper</em> and <em>Språnget_upper</em> nodes,</li><li>add a <em>unit__to_node</em>   relationship between the <em>Språnget_spill</em> and the <em>Fallet_upper</em> node,</li></ul></li><li><p>Add the relationship parameter values for the new units:</p><ul><li>Set the <em>unit_capacity</em> (to apply a   maximum), the <em>minimum_operating_point</em> (defined as a   percentage of the <em>unit_capacity</em>)   to impose a minimum, and the <em>vom_cost</em> to penalise the water that is   spilt:</li></ul><p><img src="../figs_two_hydro/two_hydro_min_spill_unit_node_node.png" alt="Setting minimum (the minimal value is defined as percentage of capacity), maximum, and spillage penalty."/></p><p><em>Setting minimum (the minimal value is defined as percentage of capacity), maximum, and spillage penalty.</em></p></li></ul><ul><li>For the <em>Språnget_spill</em> unit   define the <em>fix_ratio_out_in_unit_flow</em> parameter   value of the <em>min_spillage|Fallet_upper|Språnget_upper</em>   relationship to <strong>1</strong> (see   <a href="../../#Placing-the-units-in-the-model">adding unit relationships</a>).</li></ul><p>Commit your changes in the database, execute the project and <a href="../../#Examining-the-results">examine the results</a>! As an exercise, you can perform this process for and Fallet plant (you would also need to add another water node, downstream of Fallet).</p><h2 id="Follow-Contracted-Load-Curve"><a class="docs-heading-anchor" href="#Follow-Contracted-Load-Curve">Follow Contracted Load Curve</a><a id="Follow-Contracted-Load-Curve-1"></a><a class="docs-heading-anchor-permalink" href="#Follow-Contracted-Load-Curve" title="Permalink"></a></h2><p>It is often the case that a system of hydropower plants should follow a given production profile. To model this in the given system, all we have to do is set a demand in the form of a timeseries to the <em>electricity_node</em>.</p><ul><li>Add the <a href="https://raw.githubusercontent.com/spine-tools/Spine-Toolbox/master/docs/source/data/contracted_load.txt">Contracted load   timeseries</a>,   to the <em>demand</em> parameter value of   the <em>electricity_node</em> (see   <a href="../../#Defining-node-parameter-values">adding node parameter values</a>).</li></ul><p>Commit your changes in the database, execute the project and <a href="../../#Examining-the-results">examine the results</a>!</p><p>This concludes the tutorial, we hope that you enjoyed building hydropower systems in Spine as much as we do!</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../unit_commitment/">« Unit Commitment</a><a class="docs-footer-nextpage" href="../case_study_a5/">Case Study A5 »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Thursday 11 April 2024 13:15">Thursday 11 April 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
